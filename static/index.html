<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM ‚Üí SCORM ‚Üí Chamilo</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">üöÄ</span>
                <span class="logo-text">SCORM<span class="logo-accent">Generator</span></span>
            </div>

            <!-- Chamilo Connection -->
            <div class="panel">
                <div class="panel-header" onclick="togglePanel('chamilo-panel')">
                    <span>üì° Chamilo LMS</span>
                    <span class="status-dot" id="chamilo-status"></span>
                </div>
                <div class="panel-body" id="chamilo-panel">
                    <div class="field">
                        <label>URL</label>
                        <input type="text" id="chamilo-url" placeholder="http://192.168.8.179/chamilo">
                    </div>
                    <div class="field">
                        <label>–õ–æ–≥–∏–Ω</label>
                        <input type="text" id="chamilo-user" placeholder="admin">
                    </div>
                    <div class="field">
                        <label>–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="chamilo-pass" placeholder="password">
                    </div>
                    <button class="btn btn-sm" onclick="testChamilo()">
                        <span id="chamilo-btn-text">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</span>
                    </button>
                    <div class="status-msg" id="chamilo-msg"></div>
                </div>
            </div>

            <!-- LLM Connection -->
            <div class="panel">
                <div class="panel-header" onclick="togglePanel('llm-panel')">
                    <span>ü§ñ LLM –ú–æ–¥–µ–ª—å</span>
                    <span class="status-dot" id="llm-status"></span>
                </div>
                <div class="panel-body" id="llm-panel">
                    <div class="field">
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="llm-type" value="local" checked onchange="toggleLLMType()">
                                <span>–õ–æ–∫–∞–ª—å–Ω–∞—è (Ollama)</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="llm-type" value="api" onchange="toggleLLMType()">
                                <span>OpenAI API</span>
                            </label>
                        </div>
                    </div>
                    <div id="llm-local-fields">
                        <div class="field">
                            <label>URL —Å–µ—Ä–≤–µ—Ä–∞</label>
                            <input type="text" id="llm-url" placeholder="http://192.168.8.106:11434/v1">
                        </div>
                        <div class="field">
                            <label>–ú–æ–¥–µ–ª—å</label>
                            <input type="text" id="llm-model" placeholder="qwen2.5:72b">
                        </div>
                    </div>
                    <div id="llm-api-fields" style="display:none">
                        <div class="field">
                            <label>API Key</label>
                            <input type="password" id="llm-apikey" placeholder="sk-...">
                        </div>
                        <div class="field">
                            <label>–ú–æ–¥–µ–ª—å</label>
                            <input type="text" id="llm-model-api" placeholder="gpt-4o-mini">
                        </div>
                    </div>
                    <button class="btn btn-sm" onclick="testLLM()">
                        <span id="llm-btn-text">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</span>
                    </button>
                    <div class="status-msg" id="llm-msg"></div>
                </div>
            </div>

            <!-- Save -->
            <button class="btn btn-save" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>

            <!-- CLI Reference -->
            <div class="panel cli-panel">
                <div class="panel-header" onclick="togglePanel('cli-panel-body')">
                    <span>‚å®Ô∏è CLI –∫–æ–º–∞–Ω–¥—ã</span>
                    <span class="chevron">‚ñæ</span>
                </div>
                <div class="panel-body collapsed" id="cli-panel-body">
                    <div class="cli-table">
                        <div class="cli-row">
                            <span class="cli-desc">–ü–æ —Ç–µ–º–µ</span>
                            <code>python main.py --topic "–¢–µ–º–∞"</code>
                        </div>
                        <div class="cli-row">
                            <span class="cli-desc">+ Chamilo</span>
                            <code>python main.py --topic "–¢–µ–º–∞" --upload</code>
                        </div>
                        <div class="cli-row">
                            <span class="cli-desc">–ò–∑ JSON</span>
                            <code>python main.py -i file.json</code>
                        </div>
                        <div class="cli-row">
                            <span class="cli-desc">5 —Å—Ç—Ä.</span>
                            <code>python main.py --topic "X" -p 5</code>
                        </div>
                        <div class="cli-row">
                            <span class="cli-desc">English</span>
                            <code>python main.py --topic "X" -l en</code>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <!-- Generation Form -->
            <section class="gen-section">
                <h2>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—É—Ä—Å–∞</h2>

                <div class="gen-tabs">
                    <button class="tab active" onclick="switchTab('ai')" id="tab-ai">ü§ñ –ß–µ—Ä–µ–∑ –ò–ò</button>
                    <button class="tab" onclick="switchTab('json')" id="tab-json">üìÑ –ò–∑ JSON</button>
                </div>

                <!-- AI Generation -->
                <div class="gen-form" id="form-ai">
                    <div class="form-row">
                        <div class="field flex-grow">
                            <label>–¢–µ–º–∞ –∫—É—Ä—Å–∞</label>
                            <input type="text" id="topic" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Å–Ω–æ–≤—ã –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
                                class="input-lg">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="field">
                            <label>–°—Ç—Ä–∞–Ω–∏—Ü</label>
                            <select id="pages">
                                <option value="2">2</option>
                                <option value="3" selected>3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="8">8</option>
                                <option value="10">10</option>
                            </select>
                        </div>
                        <div class="field">
                            <label>–Ø–∑—ã–∫</label>
                            <select id="lang">
                                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                <option value="en">üá¨üáß English</option>
                            </select>
                        </div>
                        <div class="field flex-grow"></div>
                        <button class="btn btn-primary btn-lg" onclick="generateCourse()" id="btn-generate">
                            ü§ñ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>

                <!-- JSON Upload -->
                <div class="gen-form" id="form-json" style="display:none">
                    <div class="form-row">
                        <div class="field flex-grow">
                            <label>JSON —Ñ–∞–π–ª</label>
                            <div class="file-drop" id="file-drop"
                                onclick="document.getElementById('json-file').click()">
                                <span>üìÑ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ JSON –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</span>
                                <input type="file" id="json-file" accept=".json" style="display:none"
                                    onchange="loadJSON(this)">
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Progress -->
            <div class="progress-section" id="progress-section" style="display:none">
                <div class="progress-bar-wrap">
                    <div class="progress-bar" id="gen-progress"></div>
                </div>
                <div class="progress-text" id="progress-text">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—É—Ä—Å–∞...</div>
            </div>

            <!-- Preview -->
            <section class="preview-section" id="preview-section" style="display:none">
                <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫—É—Ä—Å–∞</h2>

                <div class="course-header" id="course-header"></div>
                <div class="course-pages" id="course-pages"></div>

                <!-- Actions -->
                <div class="actions">
                    <div class="actions-left">
                        <div class="course-select-group">
                            <select id="chamilo-course-select" onchange="onCourseSelect()">
                                <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤...</option>
                            </select>
                            <input type="text" id="chamilo-course-manual" placeholder="–∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫—É—Ä—Å–∞"
                                class="course-manual-input">
                            <button class="btn btn-sm btn-refresh" onclick="loadChamiloCourses()"
                                title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫">üîÑ</button>
                        </div>
                    </div>
                    <div class="actions-right">
                        <button class="btn btn-secondary" onclick="downloadSCORM()" id="btn-download">
                            üíæ –°–∫–∞—á–∞—Ç—å SCORM
                        </button>
                        <button class="btn btn-primary" onclick="uploadToChamilo()" id="btn-upload">
                            üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Chamilo
                        </button>
                    </div>
                </div>

                <div class="status-msg action-msg" id="action-msg"></div>
            </section>
        </main>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>