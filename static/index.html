<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM ‚Üí SCORM ‚Üí Chamilo</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">üöÄ</span>
                <span class="logo-text">SCORM<span class="logo-accent">Generator</span></span>
            </div>

            <!-- Chamilo Connection -->
            <div class="panel">
                <div class="panel-header" onclick="togglePanel('chamilo-panel')">
                    <span>üì° Chamilo LMS</span>
                    <span class="status-dot" id="chamilo-status"></span>
                </div>
                <div class="panel-body" id="chamilo-panel">
                    <div class="field">
                        <label>URL</label>
                        <input type="text" id="chamilo-url" placeholder="http://192.168.8.179/chamilo">
                    </div>
                    <div class="field">
                        <label>–õ–æ–≥–∏–Ω</label>
                        <input type="text" id="chamilo-user" placeholder="admin">
                    </div>
                    <div class="field">
                        <label>–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="chamilo-pass" placeholder="password">
                    </div>
                    <button class="btn btn-sm" onclick="testChamilo()">
                        <span id="chamilo-btn-text">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</span>
                    </button>
                    <div class="status-msg" id="chamilo-msg"></div>
                </div>
            </div>

            <!-- LLM Connection -->
            <div class="panel">
                <div class="panel-header" onclick="togglePanel('llm-panel')">
                    <span>ü§ñ LLM –ú–æ–¥–µ–ª—å</span>
                    <span class="status-dot" id="llm-status"></span>
                </div>
                <div class="panel-body" id="llm-panel">
                    <div class="field">
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="llm-type" value="local" checked onchange="toggleLLMType()">
                                <span>–õ–æ–∫–∞–ª—å–Ω–∞—è (Ollama)</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="llm-type" value="api" onchange="toggleLLMType()">
                                <span>OpenAI API</span>
                            </label>
                        </div>
                    </div>
                    <div id="llm-local-fields">
                        <div class="field">
                            <label>URL —Å–µ—Ä–≤–µ—Ä–∞</label>
                            <input type="text" id="llm-url" placeholder="http://192.168.8.106:11434/v1">
                        </div>
                        <div class="field">
                            <label>–ú–æ–¥–µ–ª—å</label>
                            <input type="text" id="llm-model" placeholder="qwen2.5:72b">
                        </div>
                    </div>
                    <div id="llm-api-fields" style="display:none">
                        <div class="field">
                            <label>API Key</label>
                            <input type="password" id="llm-apikey" placeholder="sk-...">
                        </div>
                        <div class="field">
                            <label>–ú–æ–¥–µ–ª—å</label>
                            <input type="text" id="llm-model-api" placeholder="gpt-4o-mini">
                        </div>
                    </div>
                    <button class="btn btn-sm" onclick="testLLM()">
                        <span id="llm-btn-text">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</span>
                    </button>
                    <div class="status-msg" id="llm-msg"></div>
                </div>
            </div>

            <!-- Save -->
            <button class="btn btn-save" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>

            <!-- CLI Reference -->
            <div class="panel cli-panel">
                <div class="panel-header" onclick="togglePanel('cli-panel-body')">
                    <span>‚å®Ô∏è CLI –∫–æ–º–∞–Ω–¥—ã</span>
                    <span class="chevron">‚ñæ</span>
                </div>
                <div class="panel-body collapsed" id="cli-panel-body">
                    <div class="cli-table">
                        <div class="cli-row">
                            <span class="cli-desc">–ü–æ —Ç–µ–º–µ</span>
                            <code>python main.py --topic "–¢–µ–º–∞"</code>
                        </div>
                        <div class="cli-row">
                            <span class="cli-desc">+ Chamilo</span>
                            <code>python main.py --topic "–¢–µ–º–∞" --upload</code>
                        </div>
                        <div class="cli-row">
                            <span class="cli-desc">–ò–∑ JSON</span>
                            <code>python main.py -i file.json</code>
                        </div>
                        <div class="cli-row">
                            <span class="cli-desc">5 —Å—Ç—Ä.</span>
                            <code>python main.py --topic "X" -p 5</code>
                        </div>
                        <div class="cli-row">
                            <span class="cli-desc">English</span>
                            <code>python main.py --topic "X" -l en</code>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <!-- Generation Form -->
            <section class="gen-section">
                <h2>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—É—Ä—Å–∞</h2>

                <div class="gen-tabs">
                    <button class="tab active" onclick="switchTab('ai')" id="tab-ai">ü§ñ –ß–µ—Ä–µ–∑ –ò–ò</button>
                    <button class="tab" onclick="switchTab('json')" id="tab-json">üìÑ –ò–∑ JSON</button>
                </div>

                <!-- AI Generation -->
                <div class="gen-form" id="form-ai">
                    <!-- Advanced Settings Toggle -->
                    <div class="adv-toggle"
                        onclick="document.getElementById('adv-settings').classList.toggle('collapsed')">
                        <span>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ò–ò</span>
                        <span class="chevron-sm">‚ñæ</span>
                    </div>
                    <div class="adv-settings" id="adv-settings">
                        <div class="form-row">
                            <div class="field">
                                <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ <span class="hint" id="temp-val">0.7</span></label>
                                <input type="range" id="temperature" min="0" max="1.5" step="0.1" value="0.7"
                                    oninput="document.getElementById('temp-val').textContent=this.value" class="slider">
                                <div class="slider-labels"><span>–¢–æ—á–Ω–µ–µ</span><span>–ö—Ä–µ–∞—Ç–∏–≤–Ω–µ–µ</span></div>
                            </div>
                            <div class="field">
                                <label>–ú–∞–∫—Å. —Ç–æ–∫–µ–Ω–æ–≤</label>
                                <select id="max-tokens">
                                    <option value="2048">2048 (–±—ã—Å—Ç—Ä–æ)</option>
                                    <option value="4096" selected>4096 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                                    <option value="8192">8192 (–ø–æ–¥—Ä–æ–±–Ω–æ)</option>
                                    <option value="16384">16384 (–º–∞–∫—Å–∏–º—É–º)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="field">
                                <label>–†–∞–∑–¥–µ–ª–æ–≤ –≤ –º–æ–¥—É–ª–µ</label>
                                <select id="sectionsPerModule">
                                    <option value="1" selected>1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>–£—Ä–æ–∫–æ–≤ (SCO) –≤ —Ä–∞–∑–¥–µ–ª–µ</label>
                                <select id="scosPerSection">
                                    <option value="1">1</option>
                                    <option value="2" selected>2</option>
                                    <option value="3">3</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>–≠–∫—Ä–∞–Ω–æ–≤ —Ç–µ–æ—Ä–∏–∏</label>
                                <select id="screensPerSco">
                                    <option value="1">1</option>
                                    <option value="2" selected>2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="field">
                                <label>–í–æ–ø—Ä–æ—Å–æ–≤ –ø–æ—Å–ª–µ —É—Ä–æ–∫–∞</label>
                                <select id="questionsPerSco">
                                    <option value="0">0</option>
                                    <option value="1" selected>1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>–ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç (–≤–æ–ø—Ä–æ—Å–æ–≤)</label>
                                <select id="finalTestQuestions">
                                    <option value="0">–ë–µ–∑ —Ç–µ—Å—Ç–∞</option>
                                    <option value="3">3</option>
                                    <option value="5" selected>5</option>
                                    <option value="10">10</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>–î–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞</label>
                                <select id="detailLevel">
                                    <option value="brief">–ö—Ä–∞—Ç–∫–æ</option>
                                    <option value="normal" selected>–ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
                                    <option value="detailed">–ü–æ–¥—Ä–æ–±–Ω–æ</option>
                                </select>
                            </div>
                        </div>
                        <div class="field">
                            <label>–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç <span class="hint">(–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ò–ò)</span></label>
                            <textarea id="system-prompt" rows="3"
                                placeholder="–¢—ã ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —É—á–µ–±–Ω—ã—Ö –∫—É—Ä—Å–æ–≤. –ì–µ–Ω–µ—Ä–∏—Ä—É–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ markdown."></textarea>
                        </div>
                        <div class="field">
                            <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ <span class="hint">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
                            <textarea id="extra-instructions" rows="2"
                                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–æ–±–∞–≤—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π –∞–Ω–∞–ª–æ–≥–∏–∏ –∏–∑ –∂–∏–∑–Ω–∏. –£—Ä–æ–≤–µ–Ω—å: –Ω–∞—á–∏–Ω–∞—é—â–∏–π."></textarea>
                        </div>
                    </div>

                    <div class="form-row" style="margin-top:12px">
                        <div class="field flex-grow">
                            <label>–¢–µ–º–∞ –∫—É—Ä—Å–∞</label>
                            <input type="text" id="topic" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Å–Ω–æ–≤—ã –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
                                class="input-lg">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="field">
                            <label>–ö–æ–ª-–≤–æ –ú–æ–¥—É–ª–µ–π</label>
                            <select id="numModules">
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="field">
                            <label>–Ø–∑—ã–∫</label>
                            <select id="lang">
                                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                <option value="en">üá¨üáß English</option>
                            </select>
                        </div>
                        <div class="field flex-grow"></div>
                        <button class="btn btn-primary btn-lg" onclick="generateCourse()" id="btn-generate">
                            ü§ñ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>

                <!-- JSON Upload -->
                <div class="gen-form" id="form-json" style="display:none">
                    <div class="form-row">
                        <div class="field flex-grow">
                            <label>JSON —Ñ–∞–π–ª</label>
                            <div class="file-drop" id="file-drop"
                                onclick="document.getElementById('json-file').click()">
                                <span>üìÑ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ JSON –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</span>
                                <input type="file" id="json-file" accept=".json" style="display:none"
                                    onchange="loadJSON(this)">
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Progress -->
            <div class="progress-section" id="progress-section" style="display:none">
                <div class="progress-header">
                    <div class="progress-step active" id="step-gen">
                        <span class="step-icon">1</span> –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
                    </div>
                    <div class="progress-step" id="step-build">
                        <span class="step-icon">2</span> –°–±–æ—Ä–∫–∞ SCORM
                    </div>
                    <div class="progress-step" id="step-done">
                        <span class="step-icon">3</span> –ì–æ—Ç–æ–≤–æ
                    </div>
                </div>
                <div class="progress-bar-wrap">
                    <div class="progress-bar" id="gen-progress"></div>
                </div>
                <div class="progress-text" id="progress-text">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—É—Ä—Å–∞...</div>
            </div>

            <!-- Preview -->
            <section class="preview-section" id="preview-section" style="display:none">
                <!-- Preview Tabs -->
                <div class="preview-tabs">
                    <button class="preview-tab active" onclick="switchPreviewTab('overview')" id="ptab-overview">
                        üìä –û–±–∑–æ—Ä –∫—É—Ä—Å–∞
                    </button>
                    <button class="preview-tab" onclick="switchPreviewTab('live')" id="ptab-live">
                        üëÅ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä SCORM
                    </button>
                    <button class="preview-tab" onclick="switchPreviewTab('json')" id="ptab-json">
                        üìù JSON –†–µ–¥–∞–∫—Ç–æ—Ä
                    </button>
                </div>

                <!-- Tab: Overview -->
                <div class="preview-pane" id="pane-overview">
                    <div class="course-header" id="course-header"></div>
                    <div class="course-pages" id="course-pages"></div>
                </div>

                <!-- Tab: Live SCORM Preview -->
                <div class="preview-pane" id="pane-live" style="display:none">
                    <div class="iframe-toolbar">
                        <button class="btn btn-sm btn-secondary" onclick="refreshPreview()">
                            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="openPreviewFullscreen()">
                            ‚õ∂ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω
                        </button>
                    </div>
                    <div class="iframe-container">
                        <iframe id="scorm-preview-iframe" src="about:blank"></iframe>
                    </div>
                </div>

                <!-- Tab: JSON Editor -->
                <div class="preview-pane" id="pane-json" style="display:none">
                    <div class="json-editor-toolbar">
                        <div class="json-toolbar-left">
                            <span class="json-status" id="json-status">Valid JSON</span>
                        </div>
                        <div class="json-toolbar-right">
                            <button class="btn btn-sm btn-secondary" onclick="formatJSON()">
                                üî§ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="saveJSON()" id="btn-save-json">
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
                            </button>
                        </div>
                    </div>
                    <textarea id="json-editor" class="json-editor" spellcheck="false"
                        oninput="validateJSONInput()"></textarea>
                    <div class="json-error" id="json-error"></div>
                </div>

                <!-- Actions -->
                <div class="actions">
                    <div class="actions-left">
                        <div class="course-select-group">
                            <select id="chamilo-course-select" onchange="onCourseSelect()">
                                <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤...</option>
                            </select>
                            <input type="text" id="chamilo-course-manual" placeholder="–∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫—É—Ä—Å–∞"
                                class="course-manual-input">
                            <button class="btn btn-sm btn-refresh" onclick="loadChamiloCourses()"
                                title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫">üîÑ</button>
                        </div>
                    </div>
                    <div class="actions-right">
                        <button class="btn btn-secondary" onclick="downloadSCORM()" id="btn-download">
                            üíæ –°–∫–∞—á–∞—Ç—å SCORM
                        </button>
                        <button class="btn btn-primary" onclick="uploadToChamilo()" id="btn-upload">
                            üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Chamilo
                        </button>
                    </div>
                </div>

                <div class="status-msg action-msg" id="action-msg"></div>
            </section>

            <!-- History -->
            <section class="history-section" id="history-section">
                <div class="history-header" onclick="toggleHistory()">
                    <h3>üìÅ –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π</h3>
                    <span class="chevron" id="history-chevron">‚ñæ</span>
                </div>
                <div class="history-body" id="history-body">
                    <div class="history-list" id="history-list">
                        <div class="history-empty">–ü–æ–∫–∞ –Ω–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤</div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>